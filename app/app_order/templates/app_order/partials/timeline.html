{# app_order/templates/app_order/partials/timeline.html #}

<div class="timeline-stepper">
  {% for st in etapas %}
    <div class="step mb-3">
      <button class="btn btn-link w-100 text-start p-2 d-flex align-items-center justify-content-between"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#step-{{ st.ordem }}"
              aria-expanded="false"
              aria-controls="step-{{ st.ordem }}">
        <div class="d-flex align-items-center gap-2">
          <span class="badge rounded-pill {% if st.status == 'concluida' %}bg-success{% else %}bg-info{% endif %}">
            {{ st.ordem }}
          </span>
          <div>
            <div><strong>{{ st.get_status_display }}</strong></div>
            <small class="text-muted">{{ st.criado_em|date:"d/m/Y H:i" }}</small>
          </div>
        </div>
        <i class="bi bi-chevron-down"></i>
      </button>

      <div id="step-{{ st.ordem }}" class="collapse ps-4">
        {% if st.ordem == 1 %}
          <p class="mb-1">
            <i class="bi bi-info-circle me-1"></i>
            <strong>Servi√ßo:</strong> {{ st.order.descricao }}
          </p>
          {% if st.order.gmg %}
            <p class="mb-1">
              <i class="bi bi-cpu me-1"></i>
              <strong>GMG:</strong> {{ st.order.gmg }}
            </p>
          {% endif %}
          {# Nova linha: quem solicitou #}
          <p class="mb-2">
            <i class="bi bi-person-lines-fill me-1"></i>
            <strong>Solicitante:</strong>
            {{ st.order.usuario.get_full_name|default:st.order.usuario.username }}
          </p>
        {% endif %}

        {% if st.foto %}
          <div class="mb-2 text-center">
            <img
              src="{{ st.foto.url }}"
              class="img-fluid rounded"
              style="max-height:120px;"
              alt="Foto da Etapa {{ st.ordem }}"
            >
          </div>
        {% endif %}

        {% if st.comentario %}
          <p class="mb-1">
            <i class="bi bi-chat-left-text me-1"></i>
            {{ st.comentario }}
          </p>
        {% endif %}

        <p class="text-muted small mb-0">
          <i class="bi bi-person-fill me-1"></i>
          {{ st.tecnico.get_full_name|default:st.tecnico.username }}
          &nbsp;|&nbsp;
          <i class="bi bi-calendar-event me-1"></i>
          {{ st.criado_em|date:"d/m/Y H:i" }}
        </p>
      </div>
    </div>
  {% empty %}
    <p class="text-center text-muted">Nenhuma etapa registrada.</p>
  {% endfor %}
</div>
